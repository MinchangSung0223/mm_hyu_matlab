function drawFK(Slist,Mlist,thetalist,show_mesh,fv)
matS = {};
T_list = {};
NumberofJoints= size(Mlist,2);
p =repmat([0; 0; 0; 1;],1,NumberofJoints);
px=[];
py=[];
pz=[];
plot3(0,0,0,'k.');
axis([-1.5 1.5 -1.5 1.5 -0.1 1.5]);
hold on;
grid on;
axis_line_length=0.2;
line([0 axis_line_length*5],[0 0],[0 0],"Color",[1,0,0]);
line([0 0],[0 axis_line_length*5],[0 0],"Color",[0,1,0]);
line([0 0],[0 0 ],[0 axis_line_length*5],"Color",[0,0,1]);

for i = 1:1:NumberofJoints
    matS_ = MatrixExp6(VecTose3(Slist(:,i))*thetalist(i));
    matS{i} = matS_;
    T_ = eye(4);
    T_2 = eye(4);
    for j = 1:1:i
        T_ = T_*matS{j};
         T_2 = T_2*Mlist{j};
    end
    T_list{i} = T_*T_2;
    px_ = p(:,i)+[axis_line_length;0.0;0.0;0];
    py_ = p(:,i)+[0.0;axis_line_length;0.0;0];
    pz_ = p(:,i)+[0.0;0.0;axis_line_length;0];
    p(:,i) = T_list{i}*p(:,i); 
    px = [px,T_list{i}*px_];
    py = [py,T_list{i}*py_];
    pz = [pz,T_list{i}*pz_];
    
end

 plot3([ 0 axis_line_length 0   p(1,1),px(1,1),p(1,1),     p(1,2),px(1,2),p(1,2),   ...
       p(1,3),px(1,3),p(1,3),     p(1,4),px(1,4),p(1,4),     p(1,5),px(1,5),p(1,5),   ...
         p(1,6),px(1,6),p(1,6)  p(1,7),px(1,7),p(1,7)   p(1,8),px(1,8),p(1,8)   p(1,9),px(1,9),p(1,9) ],...
        [0 0 0 p(2,1),px(2,1),p(2,1)     p(2,2),px(2,2),p(2,2),   ...
       p(2,3),px(2,3),p(2,3),     p(2,4),px(2,4),p(2,4),     p(2,5),px(2,5),p(2,5),   ...
         p(2,6),px(2,6),p(2,6)  p(2,7),px(2,7),p(2,7)  p(2,8),px(2,8),p(2,8)  p(2,9),px(2,9),p(2,9) ],...
        [0 0 0 p(3,1),px(3,1),p(3,1)     p(3,2),px(3,2),p(3,2),   ...
       p(3,3),px(3,3),p(3,3),     p(3,4),px(3,4),p(3,4),     p(3,5),px(3,5),p(3,5),   ...
         p(3,6),px(3,6),p(3,6)   p(3,7),px(3,7),p(3,7)   p(3,8),px(3,8),p(3,8)   p(3,9),px(3,9),p(3,9)],...
     "Color",[1,0,0]);

  plot3([ 0 axis_line_length 0   p(1,1),py(1,1),p(1,1),     p(1,2),py(1,2),p(1,2),   ...
       p(1,3),py(1,3),p(1,3),     p(1,4),py(1,4),p(1,4),     p(1,5),py(1,5),p(1,5),   ...
         p(1,6),py(1,6),p(1,6)  p(1,7),py(1,7),p(1,7)   p(1,8),py(1,8),p(1,8)   p(1,9),py(1,9),p(1,9) ],...
        [0 0 0 p(2,1),py(2,1),p(2,1)     p(2,2),py(2,2),p(2,2),   ...
       p(2,3),py(2,3),p(2,3),     p(2,4),py(2,4),p(2,4),     p(2,5),py(2,5),p(2,5),   ...
         p(2,6),py(2,6),p(2,6)  p(2,7),py(2,7),p(2,7)  p(2,8),py(2,8),p(2,8)  p(2,9),py(2,9),p(2,9) ],...
        [0 0 0 p(3,1),py(3,1),p(3,1)     p(3,2),py(3,2),p(3,2),   ...
       p(3,3),py(3,3),p(3,3),     p(3,4),py(3,4),p(3,4),     p(3,5),py(3,5),p(3,5),   ...
         p(3,6),py(3,6),p(3,6) p(3,7),py(3,7),p(3,7)   p(3,8),py(3,8),p(3,8)   p(3,9),py(3,9),p(3,9)],...
     "Color",[0,1,0]);
 
  plot3([ 0 axis_line_length 0   p(1,1),pz(1,1),p(1,1),     p(1,2),pz(1,2),p(1,2),   ...
       p(1,3),pz(1,3),p(1,3),     p(1,4),pz(1,4),p(1,4),     p(1,5),pz(1,5),p(1,5),   ...
         p(1,6),pz(1,6),p(1,6)  p(1,7),pz(1,7),p(1,7)   p(1,8),pz(1,8),p(1,8)   p(1,9),pz(1,9),p(1,9) ],...
        [0 0 0 p(2,1),pz(2,1),p(2,1)     p(2,2),pz(2,2),p(2,2),   ...
       p(2,3),pz(2,3),p(2,3),     p(2,4),pz(2,4),p(2,4),     p(2,5),pz(2,5),p(2,5),   ...
         p(2,6),pz(2,6),p(2,6) p(2,7),pz(2,7),p(2,7)  p(2,8),pz(2,8),p(2,8)  p(2,9),pz(2,9),p(2,9) ],...
        [0 0 0 p(3,1),pz(3,1),p(3,1)     p(3,2),pz(3,2),p(3,2),   ...
       p(3,3),pz(3,3),p(3,3),     p(3,4),pz(3,4),p(3,4),     p(3,5),pz(3,5),p(3,5),   ...
         p(3,6),pz(3,6),p(3,6) p(3,7),pz(3,7),p(3,7)   p(3,8),pz(3,8),p(3,8)   p(3,9),pz(3,9),p(3,9)],...
     "Color",[0,0,1]);

plot3([0 p(1,1) p(1,2) p(1,3) p(1,4) p(1,5) p(1,6) p(1,7) p(1,8) p(1,9) ],...
    [0 p(2,1) p(2,2) p(2,3) p(2,4) p(2,5) p(2,6) p(2,7) p(2,8) p(2,9)],...
    [0 p(3,1) p(3,2) p(3,3) p(3,4) p(3,5) p(3,6) p(3,7) p(3,8) p(3,9)],'k.');

plot3([0 p(1,1) p(1,2) p(1,3) p(1,4) p(1,5) p(1,6) p(1,7) p(1,8) p(1,9)],...
    [0 p(2,1) p(2,2) p(2,3) p(2,4) p(2,5) p(2,6) p(2,7) p(2,8) p(2,9)],...
    [0 p(3,1) p(3,2) p(3,3) p(3,4) p(3,5) p(3,6) p(3,7) p(3,8) p(3,9)],'k-');

if show_mesh==1
    color_ = [0.5 0.5 0.5];
        patch(stl_T(T_list{3},fv{3}),'FaceColor',      color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);
        patch(stl_T(T_list{4},fv{4}),'FaceColor',      color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);
        patch(stl_T(T_list{5},fv{5}),'FaceColor',       color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);
        patch(stl_T(T_list{6},fv{6}),'FaceColor',      color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);
        patch(stl_T(T_list{7},fv{7}),'FaceColor',       color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);
        patch(stl_T(T_list{8},fv{8}),'FaceColor',       color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);
        patch(stl_T(T_list{9},fv{9}),'FaceColor',       color_, ...
             'EdgeColor',       'none',        ...
             'FaceLighting',    'gouraud',     ...
             'AmbientStrength', 0.15);         
         camlight('headlight');  
end

daspect([1,1,1]);
drawnow("limitrate");
hold off;
    
end

function fv = stl_T(T,fv_i)
fv = fv_i;
R = T(1:3,1:3);
tx = T(1,4);
ty = T(2,4);
tz = T(3,4);

fv.vertices(:,1:3) = (R*fv_i.vertices(:,1:3)')'+repmat([tx,ty,tz],length(fv_i.vertices(:,1)),1);
end